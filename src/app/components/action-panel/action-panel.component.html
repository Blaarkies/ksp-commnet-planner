<mat-expansion-panel #expander
                     hideToggle
                     class="action-panel"
                     [ngClass]="[color, location]"
                     disabled>
  <mat-expansion-panel-header class="no-hover-effect"
                              (click)="expander.toggle();
                              menuButton.ripple.launch(0, 0)">
    <mat-panel-title class="center-title-line toolbar-text">
      <button mat-icon-button #menuButton>
        <mat-icon>{{startIcon}}</mat-icon>
      </button>

      <span>{{startTitle}}</span>

      <span class="notify-badge"
            matBadgeColor="warn"
            [matBadgeHidden]="!unreadCount"
            [matBadge]="unreadCount"></span>

      <ng-content></ng-content>
    </mat-panel-title>
  </mat-expansion-panel-header>

  <div class="overlap-container">
    <div class="list-background"></div>

    <mat-selection-list [multiple]="false">

      <ng-container *ngFor="let option of options"
                    [ngSwitch]="option.type">
        <ng-template #button>
          <ng-container *ngIf="option.unavailableMeta?.unavailable$ | async;
                               else normal">
            <div class="action-button unavailable"
                 [matTooltip]="option.unavailableMeta.tooltip"
                 (click)="$event.stopPropagation(); option.unavailableMeta.action()">
              <span class="text-white">{{option.label}}</span>
              <span matBadgeColor="warn"
                    [matBadgeHidden]="!option.unread"
                    matBadge="!"></span>
              <mat-icon>{{option.icon}}</mat-icon>
            </div>
          </ng-container>

          <ng-template #normal>
            <div class="action-button"
                 [matTooltip]="option.tooltip">
              <span class="text-white">{{option.label}}</span>
              <span matBadgeColor="warn"
                    [matBadgeHidden]="!option.unread"
                    matBadge="!"></span>
              <mat-icon>{{option.icon}}</mat-icon>
            </div>
          </ng-template>
        </ng-template>

        <mat-list-option *ngSwitchCase="actionTypes.Action"
                         [value]="option"
                         (click)="expander.close();
                                  option.actionMeta.action();
                                  updateUnreads(option)">
          <ng-container *ngTemplateOutlet="button"></ng-container>
        </mat-list-option>

        <mat-list-option *ngSwitchCase="actionTypes.Route"
                         [value]="option"
                         (click)="expander.close();
                                  updateUnreads(option);
                                  logRoute(option.actionMeta.route)"
                         routerLink="/{{option.actionMeta.route}}">
          <ng-container *ngTemplateOutlet="button"></ng-container>
        </mat-list-option>

        <mat-list-option *ngSwitchCase="actionTypes.ExternalRoute"
                         [value]="option"
                         (click)="expander.close();
                                  updateUnreads(option);
                                  logExternalLink(option.actionMeta.externalRoute)">
          <a class="anchor-invisible" [href]="option.actionMeta.externalRoute">
            <ng-container *ngTemplateOutlet="button"></ng-container>
          </a>
        </mat-list-option>

      </ng-container>
    </mat-selection-list>
  </div>
</mat-expansion-panel>
